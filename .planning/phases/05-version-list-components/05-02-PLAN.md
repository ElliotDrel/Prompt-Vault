---
phase: 05-version-list-components
plan: 02
type: execute
---

<objective>
Create the VersionList component with Accordion time-grouping and Load More pagination.

Purpose: Compose VersionListItem components into a scannable, time-grouped list with infinite scroll.
Output: Complete version list UI ready for embedding in the VersionHistoryModal (Phase 6).
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior phase summaries:
@.planning/phases/04-diff-engine-utilities/04-01-SUMMARY.md

# Dependencies from 05-01 (will exist when this plan executes):
@src/hooks/usePromptVersions.ts
@src/components/version-history/VersionListItem.tsx

# Key utilities:
@src/utils/versionUtils.ts

# UI components to use:
@src/components/ui/accordion.tsx
@src/components/ui/button.tsx
@src/components/ui/skeleton.tsx

**Tech stack available:** date-fns, shadcn/ui Accordion
**Established patterns:**
- groupVersionsByPeriod for time-based categorization
- Accordion with multiple="true" for expandable sections
- Button with variant="ghost" for Load More

**Constraining decisions:**
- Phase 4: Time grouping periods are Today, Yesterday, Last 7 Days, monthly
- PROJECT.md: Comparison modes are "previous version" OR "current version"
- PROJECT.md: Paginated version fetching with Load More button
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create VersionList component with Accordion grouping</name>
  <files>src/components/version-history/VersionList.tsx</files>
  <action>
Create the main version list component that groups versions by time period.

Component props:
```typescript
interface VersionListProps {
  promptId: string;
  currentPrompt: Prompt;
  comparisonMode: 'previous' | 'current';
  onVersionSelect: (version: PromptVersion) => void;
}
```

Implementation:
1. Use usePromptVersions hook to fetch versions for promptId
2. Apply groupVersionsByPeriod utility to group fetched versions
3. Render Accordion with type="multiple" defaultValue={["Today", "Yesterday"]} to auto-expand recent sections
4. For each time period in grouped results:
   - AccordionItem with value={period}
   - AccordionTrigger showing period name and version count badge
   - AccordionContent containing VersionListItem components
5. For each version, determine previousVersion by looking at index+1 in flattened array (versions sorted newest first, so next index is previous version)

Loading state:
- Show Skeleton placeholders (3 items) while loading
- Use existing Skeleton component from shadcn/ui

Empty state:
- If versions.length === 0 and not loading, show "No version history yet"
- Include subtext: "Version history will appear after your first edit"

Error state:
- If error exists, show error message with retry button
- Button calls refetch()

Memoization:
- Wrap component in memo()
- Use useMemo for groupVersionsByPeriod result (depends on versions array)

Do NOT handle pagination in this component - that's Task 2.
  </action>
  <verify>Component renders with mock promptId, shows accordion sections, handles loading/empty/error states</verify>
  <done>VersionList renders grouped versions in accordion, handles all states, triggers onVersionSelect</done>
</task>

<task type="auto">
  <name>Task 2: Add Load More pagination to VersionList</name>
  <files>src/components/version-history/VersionList.tsx</files>
  <action>
Extend VersionList component to support Load More pagination.

Add to existing component:
1. After the Accordion, conditionally render Load More section:
   ```tsx
   {hasNextPage && (
     <div className="flex justify-center pt-4">
       <Button
         variant="ghost"
         onClick={() => fetchNextPage()}
         disabled={isFetchingNextPage}
       >
         {isFetchingNextPage ? 'Loading...' : 'Load more versions'}
       </Button>
     </div>
   )}
   ```

2. Add version count indicator at top of list:
   ```tsx
   <div className="text-sm text-muted-foreground mb-3">
     {totalCount} version{totalCount !== 1 ? 's' : ''} total
   </div>
   ```

3. When fetchNextPage completes, newly loaded versions automatically appear in correct accordion sections due to useMemo recalculation

Loading indicator for pagination:
- Show small spinner or "Loading..." text in button when isFetchingNextPage
- Keep existing content visible (don't replace with skeleton)

Edge cases:
- If hasNextPage is false, don't render Load More button
- If totalCount is 0, skip the count indicator (empty state handles this)
- If only 1 page exists and loaded, no pagination UI needed
  </action>
  <verify>Load More button appears when hasNextPage, clicking loads more versions into correct time groups</verify>
  <done>Pagination works correctly, shows version count, Load More loads additional versions</done>
</task>

<task type="auto">
  <name>Task 3: Export version-history components from index</name>
  <files>src/components/version-history/index.ts</files>
  <action>
Create barrel export file for version-history components.

Export all components from the version-history directory:
```typescript
export { VariableChanges } from './VariableChanges';
export { VersionListItem } from './VersionListItem';
export { VersionList } from './VersionList';
```

This enables cleaner imports in Phase 6:
```typescript
import { VersionList, VariableChanges } from '@/components/version-history';
```
  </action>
  <verify>Imports work from '@/components/version-history', no circular dependencies</verify>
  <done>Barrel file exports all version-history components</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run lint` passes (only Fast Refresh warnings, acknowledged)
- [ ] `npm run build` succeeds without errors
- [ ] VersionList renders grouped accordion sections
- [ ] Load More pagination works with infinite scroll
- [ ] Empty state shows for prompts without history
- [ ] Error state shows with retry capability
- [ ] Barrel export enables clean imports
</verification>

<success_criteria>

- VersionList component fully functional with all states
- Time grouping matches PROJECT.md spec (Today, Yesterday, Last 7 Days, monthly)
- Pagination loads additional versions correctly
- All components exported via barrel file
- No unused imports or variables
- Phase 5 complete
</success_criteria>

<output>
After completion, create `.planning/phases/05-version-list-components/05-02-SUMMARY.md` following the summary template with:
- Frontmatter with dependency graph
- Performance metrics
- Files created/modified
- Decisions made during implementation
- Note: Phase 5 complete, ready for Phase 6 (Diff Display & Modal)
</output>

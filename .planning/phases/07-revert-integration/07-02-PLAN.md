---
phase: 07-revert-integration
plan: 02
type: execute
---

<objective>
Integrate version history modal into PromptView and PromptEditor components.

Purpose: Allow users to view history and revert prompts from both view and edit modes.
Output: History buttons in both components with working revert functionality.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior plan in this phase:
@.planning/phases/07-revert-integration/07-01-PLAN.md

# Key files:
@src/components/PromptView.tsx
@src/components/PromptEditor.tsx
@src/components/version-history/VersionHistoryModal.tsx
@src/hooks/useRevertToVersion.ts

**Tech stack available:** VersionHistoryModal, useRevertToVersion hook, RevertConfirmDialog
**Established patterns:** Button placement in footer actions, modal state management

**Constraining decisions:**
- History button accessible from both view and edit modes (PROJECT.md)
- Edit mode only for PromptEditor (create mode has no history)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add History button and modal to PromptView</name>
  <files>src/components/PromptView.tsx</files>
  <action>
1. Add imports:
   ```typescript
   import { History } from 'lucide-react';
   import { VersionHistoryModal, RevertConfirmDialog } from '@/components/version-history';
   import { useRevertToVersion } from '@/hooks/useRevertToVersion';
   ```

2. Add state: `const [historyOpen, setHistoryOpen] = useState(false);`

3. Add hook:
   ```typescript
   const { isReverting, pendingVersion, requestRevert, confirmRevert, cancelRevert } = useRevertToVersion({
     promptId: prompt.id,
     currentPrompt: prompt,
     onSuccess: () => setHistoryOpen(false),
   });
   ```

4. Add History button in footer (after Pin button, inside the flex div ~line 363):
   ```tsx
   <Button variant="outline" onClick={() => setHistoryOpen(true)}>
     <History className="h-4 w-4 mr-2" />
     History
   </Button>
   ```

5. Add modals after Usage History section:
   ```tsx
   <VersionHistoryModal open={historyOpen} onOpenChange={setHistoryOpen} prompt={prompt} onRevert={requestRevert} />
   <RevertConfirmDialog open={!!pendingVersion} onOpenChange={(open) => !open && cancelRevert()} versionNumber={pendingVersion?.versionNumber ?? 0} onConfirm={confirmRevert} onCancel={cancelRevert} isReverting={isReverting} />
   ```
  </action>
  <verify>npm run lint passes</verify>
  <done>History button visible in PromptView, modal opens</done>
</task>

<task type="auto">
  <name>Task 2: Add History button and modal to PromptEditor</name>
  <files>src/components/PromptEditor.tsx</files>
  <action>
1. Add imports:
   ```typescript
   import { History } from 'lucide-react';
   import { VersionHistoryModal, RevertConfirmDialog } from '@/components/version-history';
   import { useRevertToVersion } from '@/hooks/useRevertToVersion';
   ```

2. Add state: `const [historyOpen, setHistoryOpen] = useState(false);`

3. Add hook (handles missing prompt gracefully):
   ```typescript
   const { isReverting, pendingVersion, requestRevert, confirmRevert, cancelRevert } = useRevertToVersion({
     promptId: prompt?.id ?? '',
     currentPrompt: prompt ?? { id: '', title: '', body: '', variables: [], isPinned: false, timesUsed: 0, createdAt: '', updatedAt: '' },
     onSuccess: () => setHistoryOpen(false),
   });
   ```

4. Add History button in footer (after Pin button, ~line 583, only in edit mode):
   ```tsx
   {isEditing && (
     <Button variant="outline" onClick={() => setHistoryOpen(true)}>
       <History className="h-4 w-4 mr-2" />
       History
     </Button>
   )}
   ```

5. Add modals after Undefined Variables Dialog (only in edit mode):
   ```tsx
   {isEditing && prompt && (
     <>
       <VersionHistoryModal open={historyOpen} onOpenChange={setHistoryOpen} prompt={prompt} onRevert={requestRevert} />
       <RevertConfirmDialog open={!!pendingVersion} onOpenChange={(open) => !open && cancelRevert()} versionNumber={pendingVersion?.versionNumber ?? 0} onConfirm={confirmRevert} onCancel={cancelRevert} isReverting={isReverting} />
     </>
   )}
   ```
  </action>
  <verify>npm run lint passes, button only appears in edit mode</verify>
  <done>History button visible in edit mode only, modal opens</done>
</task>

<task type="auto">
  <name>Task 3: Final verification and build</name>
  <files>src/components/PromptView.tsx, src/components/PromptEditor.tsx</files>
  <action>
1. Run full lint and build to verify no errors
2. Verify no unused imports
3. Confirm both components follow same pattern for consistency
4. Ensure the existing useEffect in PromptEditor (lines 96-115) will sync form state after revert

The revert workflow is:
- User clicks History → modal opens with saved prompt versions
- User selects version → clicks Revert → confirmation dialog
- User confirms → auto-save current state → update prompt → modal closes → toast success
- Form state syncs via existing useEffect on prompt prop change
  </action>
  <verify>npm run lint && npm run build succeeds</verify>
  <done>Build passes, Phase 7 complete</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run lint` passes
- [ ] `npm run build` succeeds
- [ ] History button in PromptView footer
- [ ] History button in PromptEditor footer (edit mode only)
- [ ] Revert workflow functional in both components
</verification>

<success_criteria>
- History buttons in both PromptView and PromptEditor
- Revert workflow works from both views
- Build and lint pass
- Phase 7 (Revert & Integration) complete
</success_criteria>

<output>
After completion, create `.planning/phases/07-revert-integration/07-02-SUMMARY.md`

Note: "Phase 7 complete. Version history feature fully functional."
</output>

---
phase: 06-diff-display-modal
plan: 02
type: execute
---

<objective>
Build the VersionHistoryModal with two-column layout, comparison mode toggle, and version detail view.

Purpose: Provide users with a complete interface to browse version history, see detailed diffs, and select versions for potential revert.
Output: VersionHistoryModal component ready for integration into PromptView and PromptEditor in Phase 7.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior phase context:
@.planning/phases/05-version-list-components/05-02-SUMMARY.md
@.planning/phases/06-diff-display-modal/06-01-SUMMARY.md

# Source files to reference:
@src/components/version-history/VersionList.tsx
@src/components/version-history/VersionDiff.tsx
@src/components/version-history/VariableChanges.tsx
@src/components/version-history/index.ts
@src/components/ui/dialog.tsx
@src/components/CopyEventCard.tsx
@src/types/prompt.ts

**Tech stack available:** shadcn/ui Dialog, diff package, date-fns
**Established patterns:**
- Dialog with open/onOpenChange props (see CopyEventCard.tsx line 64)
- memo components with JSDoc
- Controlled component state management
**Constraining decisions:**
- Modal dialog UI pattern [PROJECT.md]
- Comparison modes: diff from previous version OR diff from current version [PROJECT.md]
- Two-column layout: version list left, diff detail right [PROJECT.md]
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create VersionHistoryModal with two-column layout</name>
  <files>src/components/version-history/VersionHistoryModal.tsx</files>
  <action>
Create VersionHistoryModal as a controlled Dialog component:

**Props interface:**
- open: boolean - controlled open state
- onOpenChange: (open: boolean) => void - open state handler
- prompt: Prompt - current prompt for comparison and context
- onRevert?: (version: PromptVersion) => void - optional callback when revert is requested (Phase 7 will implement)

**Layout structure:**
1. Use Dialog from @/components/ui/dialog with max-w-4xl (wider than default)
2. DialogHeader with title "Version History" and DialogDescription showing prompt title
3. Two-column layout using CSS grid (grid-cols-1 md:grid-cols-2 gap-4):
   - Left column (version list): VersionList component with scroll area
   - Right column (detail view): Selected version detail with VersionDiff

**State management:**
1. comparisonMode: 'previous' | 'current' - controlled by toggle
2. selectedVersion: PromptVersion | null - currently selected version for detail view
3. When modal opens, reset selectedVersion to null
4. When version selected from VersionList, show detail view

**Comparison mode toggle:**
- Use two Buttons with variant="outline" and aria-pressed for active state
- Options: "Compare to Previous" (default) and "Compare to Current"
- Place in header area below DialogDescription
- Active button gets bg-muted styling

**Detail view (right column):**
- When no version selected: "Select a version to see details"
- When version selected:
  - Version number and timestamp header
  - Title section with VersionDiff (if title differs)
  - Body section with VersionDiff
  - Variables section with VariableChanges component
  - Revert button (disabled if no onRevert provided, styled with variant="default")

DO NOT implement revert logic - just call onRevert callback if provided.
DO NOT add scroll locking - Dialog handles this automatically.
  </action>
  <verify>
- File exists at src/components/version-history/VersionHistoryModal.tsx
- TypeScript compilation passes: npm run build
- Modal opens/closes correctly with controlled state
  </verify>
  <done>
- VersionHistoryModal component with two-column layout
- Comparison mode toggle working
- Version selection shows detail view with diff
- Revert button present (callback-based for Phase 7)
  </done>
</task>

<task type="auto">
  <name>Task 2: Add responsive design and empty state handling</name>
  <files>src/components/version-history/VersionHistoryModal.tsx</files>
  <action>
Enhance VersionHistoryModal with responsive behavior and polish:

**Responsive design:**
1. On mobile (< md breakpoint): Stack columns vertically
2. Add max-h-[80vh] to DialogContent with overflow handling
3. Left column: max-h-[40vh] md:max-h-[60vh] with overflow-y-auto
4. Right column: max-h-[40vh] md:max-h-[60vh] with overflow-y-auto

**Empty state (inherited from VersionList but add modal-specific messaging):**
- VersionList already handles empty state internally
- No additional work needed for empty version list

**Loading state:**
- VersionList handles loading state internally
- Ensure modal doesn't shift layout during loading

**Accessibility:**
- Ensure Dialog has proper aria-labelledby (DialogTitle)
- Ensure focus management works (Dialog handles this)
- Add aria-label to toggle buttons

**Final polish:**
- Add subtle border between columns on desktop (border-l)
- Ensure dark mode styling works throughout
  </action>
  <verify>
- Modal displays correctly on mobile (single column)
- Modal displays correctly on desktop (two columns)
- Scrolling works independently in each column
- No layout shift during loading
  </verify>
  <done>
- Responsive two-column/single-column layout
- Proper scroll handling for long version lists
- Accessible markup with proper ARIA attributes
  </done>
</task>

<task type="auto">
  <name>Task 3: Update barrel export and final verification</name>
  <files>src/components/version-history/index.ts</files>
  <action>
1. Add VersionHistoryModal to the barrel export
2. Keep existing exports (VariableChanges, VersionDiff, VersionList, VersionListItem)
3. Maintain alphabetical order

Final verification:
- Run npm run lint
- Run npm run build
- Verify all exports work correctly
  </action>
  <verify>
- npm run lint passes
- npm run build succeeds
- All version-history components importable from '@/components/version-history':
  - VariableChanges
  - VersionDiff
  - VersionHistoryModal
  - VersionList
  - VersionListItem
  </verify>
  <done>
- All version-history components exported from barrel
- Build passes
- Phase 6 complete, ready for Phase 7 integration
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run lint` passes (Fast Refresh warnings acknowledged)
- [ ] `npm run build` succeeds without errors
- [ ] VersionHistoryModal renders two-column layout on desktop
- [ ] VersionHistoryModal stacks columns on mobile
- [ ] Comparison mode toggle switches between 'previous' and 'current'
- [ ] Version selection shows detail view with VersionDiff
- [ ] Revert button is present and calls onRevert when clicked
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- VersionHistoryModal ready for integration in Phase 7
- No new TypeScript errors introduced
- Phase 6 (Diff Display & Modal) complete
</success_criteria>

<output>
After completion, create `.planning/phases/06-diff-display-modal/06-02-SUMMARY.md`
</output>

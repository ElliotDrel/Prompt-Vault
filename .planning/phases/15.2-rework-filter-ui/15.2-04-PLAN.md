---
phase: 15.2-rework-filter-ui
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/FilterSortControl.tsx
  - src/components/PromptListView.tsx
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "All buttons have explicit type='button' to prevent form submission"
    - "Dropdown closes after selecting filter or sort option"
    - "Dropdown menu items have role='menuitem' for ARIA compliance"
  artifacts:
    - path: "src/components/FilterSortControl.tsx"
      provides: "Accessible dropdown with proper button types"
      contains: "role=\"menuitem\""
    - path: "src/components/PromptListView.tsx"
      provides: "Clear Filters button with explicit type"
      contains: "type=\"button\""
  key_links:
    - from: "FilterSortControl.tsx"
      to: "Button components"
      via: "onClick handlers that close dropdown"
      pattern: "setIsOpen\\(false\\)"
---

<objective>
Fix UI accessibility and UX issues (Gaps 9, 10, 11)

Purpose: Improve accessibility compliance and user experience in filter dropdown
Output: ARIA-compliant dropdown with proper button types and auto-close behavior
</objective>

<execution_context>
@C:\Users\2supe\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\2supe\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/15.2-rework-filter-ui/15.2-UAT.md
@src/components/FilterSortControl.tsx
@src/components/PromptListView.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add type='button' to all buttons (GAP 9)</name>
  <files>src/components/FilterSortControl.tsx, src/components/PromptListView.tsx</files>
  <action>
    In FilterSortControl.tsx, add type="button" to Button components:

    1. Line 131 (direction toggle Button):
    ```
    <Button
      type="button"  // Add this
      variant="ghost"
      ...
    ```

    2. Line 159 (filter option buttons in the map):
    ```
    <Button
      type="button"  // Add this
      key={value}
      variant="ghost"
      ...
    ```

    3. Line 193 (sort option buttons in the map):
    ```
    <Button
      type="button"  // Add this
      key={value}
      variant="ghost"
      ...
    ```

    In PromptListView.tsx, add type="button" to Clear Filters button:

    Line 166:
    ```
    <Button
      type="button"  // Add this
      variant="outline"
      onClick={() => {
    ```

    Note: The search clear button (line 107-114) already has type="button" as part of the
    native button element.
  </action>
  <verify>
    Grep FilterSortControl.tsx for "<Button" - verify each has type="button"
    Grep PromptListView.tsx for "<Button" - verify it has type="button"
    Run `npm run build` - no errors
  </verify>
  <done>All Button components have explicit type="button" attribute</done>
</task>

<task type="auto">
  <name>Task 2: Close dropdown after selection (GAP 10)</name>
  <files>src/components/FilterSortControl.tsx</files>
  <action>
    In FilterSortControl.tsx, add setIsOpen(false) to click handlers:

    1. Line 166 (filter option onClick):
    Change from:
    ```
    onClick={() => onFilterChange(value)}
    ```
    To:
    ```
    onClick={() => {
      onFilterChange(value);
      setIsOpen(false);
    }}
    ```

    2. Line 200 (sort option onClick):
    Change from:
    ```
    onClick={() => onSortByChange(value)}
    ```
    To:
    ```
    onClick={() => {
      onSortByChange(value);
      setIsOpen(false);
    }}
    ```

    Note: The direction toggle buttons (lines 135 and 184) do NOT need to close the dropdown
    since users often want to toggle direction and then select a sort option.
  </action>
  <verify>
    In browser: Click a filter option - dropdown should close immediately
    In browser: Click a sort option - dropdown should close immediately
    In browser: Click direction toggle - dropdown should stay open (intentional)
  </verify>
  <done>Dropdown closes after selecting filter or sort option</done>
</task>

<task type="auto">
  <name>Task 3: Add ARIA menuitem roles (GAP 11)</name>
  <files>src/components/FilterSortControl.tsx</files>
  <action>
    In FilterSortControl.tsx, add role="menuitem" to buttons inside the dropdown menu:

    1. Line 159 (filter option buttons):
    ```
    <Button
      type="button"
      key={value}
      role="menuitem"  // Add this
      variant="ghost"
      ...
    ```

    2. Line 193 (sort option buttons):
    ```
    <Button
      type="button"
      key={value}
      role="menuitem"  // Add this
      variant="ghost"
      ...
    ```

    Note: The direction toggle buttons in the dropdown header don't need role="menuitem"
    as they are utility controls, not menu items. The menu container at line 146 already
    has role="menu".
  </action>
  <verify>
    Grep FilterSortControl.tsx for 'role="menuitem"' - should find 2 occurrences
    Grep FilterSortControl.tsx for 'role="menu"' - should find 1 occurrence (container)
    Run accessibility audit in browser dev tools - no ARIA violations for menu
  </verify>
  <done>Filter and sort option buttons have role="menuitem" inside role="menu" container</done>
</task>

</tasks>

<verification>
1. `npm run build` passes with no TypeScript errors
2. `npm run lint` passes
3. In browser: Select filter option - dropdown closes
4. In browser: Select sort option - dropdown closes
5. In browser dev tools: Elements have correct ARIA roles
6. No form submission triggered when clicking buttons
</verification>

<success_criteria>
- All 3 gaps (9, 10, 11) resolved
- No build or lint errors
- ARIA-compliant dropdown structure
- Intuitive dropdown close behavior
</success_criteria>

<output>
After completion, create `.planning/phases/15.2-rework-filter-ui/15.2-04-SUMMARY.md`
</output>

# 15.2-01 Summary: Rework Filter UI with Segmented Control

## What Was Built

### FilterSortControl Component
- New segmented control pattern replacing FilterSortPopover
- Inline trigger bar with filter|sort|direction sections
- Two-column dropdown menu for quick selection
- Direction toggle accessible directly on the bar (no need to open dropdown)
- Pure CSS dropdown positioning using `position: absolute` (eliminates scroll jitter)
- Support for both visibility filter (Dashboard) and author filter (Library)
- Check marks on selected options with primary color highlighting
- Click-outside and Escape key to close dropdown

### Debug Session 1: Scroll Jitter Fix
**Problem:** Dropdown bobbled/lagged during fast page scroll
**Root Cause:** Radix Popover uses Floating UI (JavaScript-based positioning) which cannot update synchronously with browser scroll rendering
**Solution:** Replaced Radix Popover with pure CSS dropdown using `position: absolute` + `top-full` + `right-0` relative to a `position: relative` parent
**Result:** Zero jitter — browser handles CSS positioning synchronously with scroll

### Debug Session 2: Scroll-to-Top Fix
**Problem:** Page scrolled to top when selecting any filter/sort option
**Root Cause:** React Router's `setSearchParams` triggers scroll-to-top by default, treating URL param updates as navigation events
**Solution:** Added `preventScrollReset: true` to setSearchParams options in useURLFilterSync.ts
**Result:** Scroll position preserved when updating filters

### Style Adjustments
- Search input min-width set to 200px
- Search input max-width capped at 3xl for consistent layout

## Files Changed

### Created
- `src/components/FilterSortControl.tsx` — New segmented control component (214 lines)
- `.planning/debug/resolved/filter-popover-scroll-lag.md` — Debug session documentation
- `.planning/debug/resolved/filter-scroll-to-top.md` — Debug session documentation

### Modified
- `src/components/PromptListView.tsx` — Import and use FilterSortControl
- `src/hooks/useURLFilterSync.ts` — Add `preventScrollReset: true` to setSearchParams
- `CLAUDE.md` — Document Radix scroll jitter pattern and React Router scroll behavior
- `AGENTS.md` — Sync with CLAUDE.md updates
- `src/App.tsx` — Remove unused import

### Deleted
- `src/components/FilterSortPopover.tsx` — Replaced by FilterSortControl (267 lines removed)

## Commits

| Hash | Message |
|------|---------|
| `4fdeea0` | docs(15.2): add initial planning for Filter UI rework |
| `63df2c4` | refactor(15.2): replace FilterSortPopover with segmented FilterSortControl |
| `a3dc480` | fix(15.2): replace Radix Popover with pure CSS dropdown to eliminate scroll jitter |
| `50a2582` | fix(15.2): prevent scroll-to-top on filter/sort selection |
| `9850d8b` | style(15.2): adjust search input width in PromptListView for better layout |

## Key Learnings

### 1. Radix/Floating UI Scroll Jitter
When using Radix Popover or any Floating UI-based positioning, expect scroll jitter during fast scroll. The JavaScript-based position calculations can't be perfectly synchronous with browser scroll rendering. **Solution:** Use pure CSS positioning (`position: absolute` relative to parent) for dropdowns that need to stay anchored during scroll.

### 2. React Router setSearchParams Scroll Reset
React Router's `setSearchParams` treats URL param updates as navigation events by default, which triggers scroll-to-top behavior. For filter/sort controls that update URL params without navigating, always include `preventScrollReset: true` in the options:
```typescript
setSearchParams(params, { replace: true, preventScrollReset: true });
```

## Verification Checklist

- [x] FilterSortControl renders correctly on Dashboard
- [x] FilterSortControl renders correctly on Library
- [x] Visibility filter works on Dashboard (All/Public/Private)
- [x] Author filter works on Library (All/Mine/Others)
- [x] Sort options work on both pages
- [x] Direction toggle works from bar and dropdown
- [x] Dropdown has no jitter during scroll
- [x] Filter selection does not scroll page to top
- [x] URL params update correctly
- [x] Filter preferences persist to database

## Net Impact

- Lines removed: 267 (FilterSortPopover)
- Lines added: 214 (FilterSortControl)
- Net change: -53 lines
- Debug sessions: 2 (both resolved)
- Patterns documented: 2 (added to CLAUDE.md)

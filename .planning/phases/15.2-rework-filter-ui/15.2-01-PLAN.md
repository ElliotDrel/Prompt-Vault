---
wave: 1
autonomous: true
gap_closure: false
---

# Plan 15.2-01: Rework Filter UI with Segmented Control

## Objective

Replace the existing FilterSortPopover component with a new FilterSortControl that uses a segmented control pattern for improved aesthetics and usability.

## Must Haves

1. **FilterSortControl component** — New component with inline filter|sort|direction bar
2. **Pure CSS dropdown positioning** — Use `position: absolute` instead of Radix/Floating UI
3. **Two-column dropdown menu** — Filter options on left, sort options on right
4. **Direction toggle on bar** — Quick access without opening dropdown
5. **Integration with PromptListView** — Replace FilterSortPopover usage
6. **Scroll position preservation** — URL param updates should not scroll to top

## Tasks

### Task 1: Create FilterSortControl component
- [x] Create `src/components/FilterSortControl.tsx`
- [x] Implement segmented control trigger bar with filter|sort|direction sections
- [x] Add two-column dropdown with filter and sort options
- [x] Support both visibility filter (Dashboard) and author filter (Library)
- [x] Direction toggle button on the bar for quick access
- [x] Click-outside detection to close dropdown
- [x] Escape key to close dropdown

**Commit:** `refactor(15.2): replace FilterSortPopover with segmented FilterSortControl`

### Task 2: Integrate FilterSortControl in PromptListView
- [x] Replace FilterSortPopover import with FilterSortControl
- [x] Update PromptListView to use new component
- [x] Remove FilterSortPopover.tsx (no longer needed)
- [x] Remove unused import from App.tsx

**Commit:** (included in Task 1 commit)

### Task 3: Fix scroll jitter on dropdown (DEBUG SESSION)
- [x] Investigate Radix Popover scroll jitter during fast scroll
- [x] Identify root cause: Floating UI JS-based positioning can't sync with browser scroll
- [x] Replace with pure CSS dropdown using `position: absolute` + `top-full`
- [x] Verify dropdown is perfectly anchored during scroll
- [x] Document pattern in CLAUDE.md

**Commit:** `fix(15.2): replace Radix Popover with pure CSS dropdown to eliminate scroll jitter`

### Task 4: Fix scroll-to-top on filter selection (DEBUG SESSION)
- [x] Investigate page scrolling to top on every filter/sort option click
- [x] Eliminate button type theory
- [x] Trace data flow to find React Router's setSearchParams
- [x] Identify root cause: setSearchParams triggers scroll-to-top by default
- [x] Add `preventScrollReset: true` to setSearchParams options in useURLFilterSync.ts
- [x] Document pattern in CLAUDE.md

**Commit:** `fix(15.2): prevent scroll-to-top on filter/sort selection`

### Task 5: Adjust search input width
- [x] Update search input min-width to 200px
- [x] Add max-width of 3xl for consistent layout

**Commit:** `style(15.2): adjust search input width in PromptListView for better layout`

## Dependencies

- Phase 15.1 complete (filter system functional)
- useURLFilterSync hook available
- usePromptFilters types exported

## Verification

- [ ] FilterSortControl renders correctly on Dashboard
- [ ] FilterSortControl renders correctly on Library
- [ ] Visibility filter works on Dashboard (All/Public/Private)
- [ ] Author filter works on Library (All/Mine/Others)
- [ ] Sort options work on both pages
- [ ] Direction toggle works from bar and dropdown
- [ ] Dropdown has no jitter during scroll
- [ ] Filter selection does not scroll page to top
- [ ] URL params update correctly
- [ ] Filter preferences persist to database

## Files Changed

### Created
- `src/components/FilterSortControl.tsx` (214 lines)
- `.planning/debug/resolved/filter-popover-scroll-lag.md`
- `.planning/debug/resolved/filter-scroll-to-top.md`

### Modified
- `src/components/PromptListView.tsx` — Import and use FilterSortControl
- `src/hooks/useURLFilterSync.ts` — Add preventScrollReset option
- `CLAUDE.md` — Document Radix scroll jitter and React Router scroll patterns
- `AGENTS.md` — Sync with CLAUDE.md updates

### Deleted
- `src/components/FilterSortPopover.tsx` (267 lines removed)

## Net Change

- Removed 267 lines (FilterSortPopover)
- Added 214 lines (FilterSortControl)
- Net: -53 lines (90 fewer than original estimate due to additional debug fixes)

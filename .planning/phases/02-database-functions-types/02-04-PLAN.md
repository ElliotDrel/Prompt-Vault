---
phase: 02-database-functions-types
plan: 04
type: execute
---

<objective>
Define TypeScript interfaces for version data structures and storage adapter methods to enable type-safe version operations.

Purpose: Provide type definitions that match the database schema and RPC functions, following existing type patterns in the codebase.
Output: PromptVersion interface, VersionsStorageAdapter interface, and regenerated Supabase types with version table definitions.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-database-schema-rls/01-01-SUMMARY.md
@.planning/phases/02-database-functions-types/02-01-SUMMARY.md
@.planning/phases/02-database-functions-types/02-02-SUMMARY.md
@.planning/phases/02-database-functions-types/02-03-SUMMARY.md
@src/types/prompt.ts
@src/lib/storage/types.ts

**Tech stack available:** TypeScript 5.5, existing type patterns (Prompt, CopyEvent interfaces)
**Established patterns:** Separate interfaces for entities, storage adapters split by concern, camelCase for TS vs snake_case in DB
**Constraining decisions:**
- Phase 1: Version columns: id, prompt_id, user_id, version_number, title, body, variables, is_consolidated, consolidation_group_id, created_at
- Phase 2 Plans 1-3: RPC functions (create_prompt_version, get_prompt_versions, consolidate_prompt_versions)

**Type structure:**
- PromptVersion interface matches database columns (camelCase property names)
- PaginatedVersions interface for paginated results
- VersionsStorageAdapter interface defines CRUD methods
- Regenerate src/lib/database.types.ts from Supabase schema
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add PromptVersion interface to types</name>
  <files>src/types/prompt.ts</files>
  <action>Add PromptVersion interface to src/types/prompt.ts after CopyEvent interface. Properties: id (string), promptId (string), userId (string), versionNumber (number), title (string), body (string), variables (string[]), isConsolidated (boolean), consolidationGroupId (string | null), createdAt (string). Export interface. Add PaginatedVersions interface with properties: versions (PromptVersion[]), hasMore (boolean), totalCount (number). Follow existing code style (camelCase, explicit types, no optional chaining where not needed).</action>
  <verify>TypeScript compilation succeeds, interfaces exported from module</verify>
  <done>PromptVersion and PaginatedVersions interfaces added to types</done>
</task>

<task type="auto">
  <name>Task 2: Add VersionsStorageAdapter interface to storage types</name>
  <files>src/lib/storage/types.ts</files>
  <action>Add VersionsStorageAdapter interface to src/lib/storage/types.ts after StatsStorageAdapter. Methods: createVersion(data: { promptId: string; versionNumber: number; title: string; body: string; variables: string[] }) => Promise<PromptVersion>, getVersions(promptId: string, offset?: number, limit?: number) => Promise<PaginatedVersions>, consolidateVersions(promptId: string) => Promise<number>. Import PromptVersion and PaginatedVersions from '@/types/prompt'. Add versions property to StorageAdapter interface: versions: VersionsStorageAdapter.</action>
  <verify>TypeScript compilation succeeds, no import errors, interface structure matches RPC function signatures</verify>
  <done>VersionsStorageAdapter interface added and integrated into StorageAdapter</done>
</task>

<task type="auto">
  <name>Task 3: Regenerate Supabase types from schema</name>
  <files>src/lib/database.types.ts</files>
  <action>Regenerate TypeScript types from remote Supabase schema using command: `npx supabase gen types typescript --linked --schema public | Out-File -Encoding utf8 src/lib/database.types.ts` (PowerShell). Verify prompt_versions table definition appears in generated types with all columns. Verify RPC function types for create_prompt_version, get_prompt_versions, consolidate_prompt_versions appear in Database['public']['Functions'] section.</action>
  <verify>database.types.ts regenerated with prompt_versions table and RPC function types, TypeScript compilation succeeds</verify>
  <done>Supabase types regenerated from remote schema including version table and RPC functions</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] PromptVersion interface matches database schema columns
- [ ] PaginatedVersions interface supports pagination pattern
- [ ] VersionsStorageAdapter methods match RPC function signatures
- [ ] TypeScript compilation passes without errors
- [ ] database.types.ts includes prompt_versions table definition
- [ ] database.types.ts includes RPC function types
- [ ] All interfaces exported and importable
</verification>

<success_criteria>

- PromptVersion interface defined in src/types/prompt.ts
- PaginatedVersions interface defined for paginated results
- VersionsStorageAdapter interface defined in src/lib/storage/types.ts
- StorageAdapter interface extended with versions property
- database.types.ts regenerated with version table and RPC types
- All TypeScript compilation passes
- No import errors or type mismatches
- Phase 2 complete, ready for Phase 3 (Storage Adapter Integration)
</success_criteria>

<output>
After completion, create `.planning/phases/02-database-functions-types/02-04-SUMMARY.md`:

# Phase 2 Plan 4: Define TypeScript interfaces Summary

**[Substantive one-liner - what shipped, not "plan complete"]**

## Accomplishments

- [Key outcome 1]
- [Key outcome 2]

## Files Created/Modified

- `path/to/file.ts` - Description

## Decisions Made

[Key decisions and rationale, or "None"]

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Step

Phase 2 complete, ready for Phase 3 (Storage Adapter Integration)
</output>

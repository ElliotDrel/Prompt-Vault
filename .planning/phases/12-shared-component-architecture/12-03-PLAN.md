---
phase: 12-shared-component-architecture
plan: 03
type: execute
domain: react-typescript
---

<objective>
Add variant support to PromptCard for different rendering contexts (owned, saved, public library).

Purpose: Enable PromptCard to render appropriately based on prompt source and user context, supporting the public library feature.
Output: Updated PromptCard with variant-aware rendering and flexible action handlers.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-shared-component-architecture/12-01-PLAN.md
@.planning/phases/12-shared-component-architecture/12-02-PLAN.md

# Types from Plan 01:
@src/types/prompt.ts

# Current PromptCard implementation:
@src/components/PromptCard.tsx

# Context patterns:
@src/contexts/PromptsContext.tsx

**Tech stack available:**
- React 18.3 with hooks
- Framer Motion for animations
- Tailwind CSS for styling
- shadcn/ui components
- lucide-react icons

**Established patterns:**
- Props interface at top of component file
- Event handlers use `handleXxx` naming
- SessionStorage for variable persistence
- Copy flow with stats increment

**Constraining decisions:**
- Phase 11: saved_prompts table tracks live-linked prompts
- Phase 12-01: PromptSource type ('owned' | 'saved' | 'public')
- Copy action always records to current user's history

**Context from exploration:**
PromptCard currently assumes:
- Prompt belongs to current user
- Copy increments user's stats
- Pin action is always available
- Navigation to /dashboard/prompt/{id}

For public library support, card needs to:
- Show author attribution for public prompts
- Conditionally show pin action (only for owned)
- Support different action sets:
  - Owned: copy, pin, view/edit
  - Saved: copy, view (read-only)
  - Public: copy, save to vault, fork, view
- Use flexible navigation based on source
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add variant and source props to PromptCard</name>
  <files>src/components/PromptCard.tsx</files>
  <action>
Update PromptCard to accept variant-related props while maintaining backward compatibility:

1. **Extend props interface**:
   ```typescript
   import type { PromptSource, AuthorInfo } from '@/types/prompt';

   interface PromptCardProps {
     prompt: Prompt;
     to: string;

     // New optional props for variant support
     source?: PromptSource;  // Default: 'owned'
     author?: AuthorInfo;    // For public prompts, display author name

     // Action customization (all optional, use defaults if not provided)
     onCopy?: (prompt: Prompt) => Promise<void>;
     onPin?: (promptId: string) => Promise<void>;
     showPinAction?: boolean;  // Default: true for 'owned', false otherwise
     showStats?: boolean;      // Default: true (usage count, time saved)

     // Stats override (for when viewing other users' prompts)
     timeSavedMultiplier?: number;  // Default: from PromptsContext
   }
   ```

2. **Derive defaults from source**:
   ```typescript
   const source = props.source ?? 'owned';
   const showPinAction = props.showPinAction ?? (source === 'owned');
   const showStats = props.showStats ?? true;
   ```

3. **Keep all existing functionality working** when no new props provided:
   - If source not provided, defaults to 'owned' (current behavior)
   - If onCopy not provided, uses context's copy flow (current behavior)
   - If onPin not provided, uses context's togglePinPrompt (current behavior)

4. **Do NOT change any existing rendering or behavior yet** - this task only adds the props interface. Task 2 will implement the conditional rendering.

This ensures Dashboard continues to work without any changes while enabling new capabilities.
  </action>
  <verify>npm run build passes, Dashboard still renders PromptCard correctly</verify>
  <done>PromptCard props extended with source, author, and action override props with backward-compatible defaults</done>
</task>

<task type="auto">
  <name>Task 2: Implement variant-aware rendering in PromptCard</name>
  <files>src/components/PromptCard.tsx</files>
  <action>
Add conditional rendering based on source/variant props:

1. **Author attribution** (for public prompts):
   ```typescript
   {author && (
     <div className="text-xs text-muted-foreground">
       by {author.displayName || 'Anonymous'}
     </div>
   )}
   ```
   Place below the title, above the "Last updated" timestamp.

2. **Conditional pin button**:
   ```typescript
   {showPinAction && (
     <Button
       variant="ghost"
       size="icon"
       onClick={handlePinToggle}
       // ... existing pin button code
     >
       {prompt.isPinned ? <PinOff /> : <Pin />}
     </Button>
   )}
   ```

3. **Use custom action handlers when provided**:
   ```typescript
   const handleCopy = async () => {
     if (props.onCopy) {
       await props.onCopy(prompt);
     } else {
       // Existing copy logic using context
       await incrementPromptUsage(prompt.id);
       await incrementCopyCount();
       // ...
     }
   };

   const handlePinToggle = async () => {
     if (props.onPin) {
       await props.onPin(prompt.id);
     } else {
       await togglePinPrompt(prompt.id);
     }
   };
   ```

4. **Use multiplier override when provided**:
   ```typescript
   const multiplier = props.timeSavedMultiplier ?? stats.timeSavedMultiplier;
   const timeSaved = (prompt.timesUsed || 0) * multiplier;
   ```

5. **Conditionally show stats**:
   ```typescript
   {showStats && (
     <div className="text-xs text-muted-foreground">
       Used {prompt.timesUsed || 0} times Â· Saved {timeSaved} min
     </div>
   )}
   ```

6. **Visual indicator for source** (subtle styling difference):
   - For 'saved' prompts: Add a small "linked" icon or badge
   - For 'public' prompts: No extra indicator (author attribution is enough)

Keep the card visually consistent - changes should be minimal and not disrupt the existing design.
  </action>
  <verify>npm run build passes, Dashboard renders correctly, no visual regressions</verify>
  <done>PromptCard renders conditionally based on source prop, author attribution displays, actions respect custom handlers</done>
</task>

<task type="auto">
  <name>Task 3: Verify integration and test all variants</name>
  <files>src/components/Dashboard.tsx</files>
  <action>
Verify that all PromptCard variants work correctly:

1. **Test default behavior** (no changes to Dashboard):
   - Dashboard should continue using PromptCard without passing new props
   - Verify: copy works, pin works, stats display, navigation works

2. **Create a temporary test in Dashboard** to verify variant rendering:
   Add a commented-out test block that can be enabled for manual testing:
   ```typescript
   // TEMP: Uncomment to test PromptCard variants
   // {filteredPrompts.length > 0 && (
   //   <div className="mb-8 p-4 border rounded-lg">
   //     <h3 className="mb-4 font-semibold">Variant Tests</h3>
   //     <div className="grid grid-cols-3 gap-4">
   //       {/* Owned (default) */}
   //       <PromptCard prompt={filteredPrompts[0]} to="#" />
   //       {/* Saved */}
   //       <PromptCard prompt={filteredPrompts[0]} to="#" source="saved" />
   //       {/* Public with author */}
   //       <PromptCard
   //         prompt={filteredPrompts[0]}
   //         to="#"
   //         source="public"
   //         author={{ userId: 'test', displayName: 'Test User' }}
   //         showPinAction={false}
   //       />
   //     </div>
   //   </div>
   // )}
   ```

3. **Verify each variant manually** (enable test block, check in browser):
   - Owned: Shows pin button, no author, full stats
   - Saved: No pin button, no author (or could show original author)
   - Public: No pin button, shows author, full stats

4. **Remove or comment out test block** after verification.

5. **Run full build and lint**:
   ```bash
   npm run lint
   npm run build
   ```

6. **Document any edge cases** discovered during testing in the summary.
  </action>
  <verify>npm run build passes, npm run lint passes, all variants render correctly</verify>
  <done>All PromptCard variants tested and working, Dashboard unchanged, integration verified</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] `npm run lint` passes with no warnings
- [ ] Dashboard prompts render exactly as before (no visual regression)
- [ ] PromptCard with source="owned" shows pin button
- [ ] PromptCard with source="saved" hides pin button
- [ ] PromptCard with source="public" shows author attribution
- [ ] Custom onCopy handler is called when provided
- [ ] Custom onPin handler is called when provided
- [ ] Stats use timeSavedMultiplier override when provided
- [ ] Copy functionality still works end-to-end on Dashboard
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Dashboard unchanged from user perspective
- PromptCard supports all three source variants
- Custom action handlers work correctly
- Ready for Phase 15 (Public Library Page) to use PromptCard with source="public"
</success_criteria>

<output>
After completion, create `.planning/phases/12-shared-component-architecture/12-03-SUMMARY.md`

Phase 12 complete after this plan. Shared component architecture ready for:
- Phase 14: Visibility Toggle (uses existing Prompt types)
- Phase 15: Public Library Page (uses PromptListView + PromptCard with source="public")
</output>

---
phase: 15.4-public-prompt-ux-improvements
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/PromptView.tsx
  - src/pages/PublicPromptDetail.tsx
autonomous: true

must_haves:
  truths:
    - "View Public Version button appears next to visibility toggle (top-right area) on Dashboard prompt detail"
    - "Owner clicking their own prompt card in Library auto-redirects to /dashboard/prompt/:id"
  artifacts:
    - path: "src/components/PromptView.tsx"
      provides: "Relocated View Public Version button near visibility toggle"
      contains: "showViewPublicButton"
    - path: "src/pages/PublicPromptDetail.tsx"
      provides: "Auto-redirect for owners to Dashboard"
      contains: "navigate(`/dashboard/prompt/"
  key_links:
    - from: "src/pages/PublicPromptDetail.tsx"
      to: "/dashboard/prompt/:id"
      via: "useEffect redirect when isOwner is true"
      pattern: "isOwner.*navigate"
---

<objective>
Improve navigation flow by relocating the "View Public Version" button and adding auto-redirect for owners viewing their own prompts in Library.

Purpose:
1. Group visibility-related controls together for better UX (button near toggle)
2. Reduce friction for owners - they don't need to see the public view banner and click through; just redirect them to their editable Dashboard view

Output: PromptView with relocated button, PublicPromptDetail with owner auto-redirect
</objective>

<execution_context>
@C:\Users\2supe\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\2supe\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@src/components/PromptView.tsx
@src/pages/PublicPromptDetail.tsx
@src/pages/PromptDetail.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Relocate "View Public Version" button next to visibility toggle</name>
  <files>src/components/PromptView.tsx</files>
  <action>
Currently the "View Public Version" button is in the header action buttons area (lines 310-315) next to Edit and History buttons.

Move the button to be next to the visibility toggle (top-right header area, lines 264-270).

Steps:
1. Remove the showViewPublicButton/onViewPublicVersion rendering from the header actions area (around line 310)
2. Add the button inside the top header row where VisibilityToggle is rendered (around line 264-270)
3. Create a flex container that holds both the VisibilityToggle and the View Public Version button
4. Only render the button when `showViewPublicButton && onViewPublicVersion` is truthy

Layout change:
```tsx
{/* Header row: Back button on left, Visibility toggle + View Public on right */}
<div className="flex justify-between items-start mb-6">
  <Button variant="ghost" className="-ml-2" asChild>
    {/* back button */}
  </Button>
  <div className="flex items-center gap-3">
    {showViewPublicButton && onViewPublicVersion && (
      <Button variant="outline" size="sm" onClick={onViewPublicVersion}>
        <Globe className="h-4 w-4 mr-2" />
        View Public Version
      </Button>
    )}
    {(showVisibilityToggle ?? true) && (
      <VisibilityToggle ... />
    )}
  </div>
</div>
```

The button should be a smaller size="sm" variant to match the toggle area better than the main action buttons.
  </action>
  <verify>
1. Navigate to Dashboard -> click a public prompt
2. The "View Public Version" button should appear in the top-right area next to the visibility toggle
3. The button should NOT appear in the action buttons row (where Edit and History are)
4. Click the button - should navigate to /library/prompt/:id
  </verify>
  <done>"View Public Version" button is positioned next to visibility toggle in top-right header area</done>
</task>

<task type="auto">
  <name>Task 2: Auto-redirect owners from Library detail to Dashboard</name>
  <files>src/pages/PublicPromptDetail.tsx</files>
  <action>
Currently when an owner clicks their own prompt card in the Library, they see a read-only public view with a "View in Dashboard" banner. This adds unnecessary friction.

Add auto-redirect for owners:

1. After the `usePublicPrompt` hook resolves and before rendering, check if `isOwner` is true
2. If owner, use `useEffect` with `navigate()` to redirect to `/dashboard/prompt/${promptId}`
3. While redirecting, show a brief loading state (can reuse the existing loading UI)
4. The redirect should use `{ replace: true }` to avoid adding the Library URL to history

Implementation:
```tsx
// Add this useEffect after isOwner is determined
useEffect(() => {
  if (!loading && prompt && isOwner) {
    navigate(`/dashboard/prompt/${promptId}`, { replace: true });
  }
}, [loading, prompt, isOwner, promptId, navigate]);

// In the render section, return loading state if redirecting
if (!loading && prompt && isOwner) {
  // Show loading while redirect happens (effect runs async)
  return (
    <>
      <Navigation />
      <div className="min-h-screen flex items-center justify-center">
        <div className="text-center">
          <Loader2 className="h-12 w-12 animate-spin mx-auto mb-4 text-primary" />
          <p className="text-lg text-muted-foreground">Redirecting to Dashboard...</p>
        </div>
      </div>
    </>
  );
}
```

This replaces the current behavior where owners see the public view with a banner.
  </action>
  <verify>
1. Go to Library page (/library)
2. Click on one of your own public prompts (should have your truncated user ID as author)
3. Should immediately redirect to /dashboard/prompt/:id (not show the public view)
4. Browser history should not have the /library/prompt/:id URL (replace: true)
  </verify>
  <done>Owners clicking their own prompts in Library are auto-redirected to Dashboard detail page</done>
</task>

</tasks>

<verification>
- `npm run build` completes without errors
- `npm run lint` passes
- View Public Version button is in top-right area on Dashboard prompt detail
- Owner auto-redirect works from Library to Dashboard
</verification>

<success_criteria>
- "View Public Version" button appears next to visibility toggle (not in action buttons)
- Owner clicking own prompt in Library redirects to Dashboard within 500ms
- No flash of public view content during redirect
- Non-owners still see the public view as expected
</success_criteria>

<output>
After completion, create `.planning/phases/15.4-public-prompt-ux-improvements/15.4-02-SUMMARY.md`
</output>

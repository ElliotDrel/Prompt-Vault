---
phase: 15.1-visibility-filter-persistence
plan: 03
type: execute
---

<objective>
Add filter chip UI components and integrate with Dashboard and Library pages.

Purpose: Complete the user-facing filter system with visual chips and page integration.
Output: Filter chips in PromptListView, full integration in Dashboard and PublicLibrary pages.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
@~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/15.1-visibility-filter-persistence/15.1-CONTEXT.md
@.planning/phases/15.1-visibility-filter-persistence/15.1-RESEARCH.md
@.planning/phases/15.1-visibility-filter-persistence/15.1-01-SUMMARY.md
@.planning/phases/15.1-visibility-filter-persistence/15.1-02-SUMMARY.md

**Key files:**
@src/components/PromptListView.tsx
@src/components/Dashboard.tsx
@src/pages/PublicLibrary.tsx
@src/components/ui/button.tsx

**Constraining decisions:**
- CONTEXT: Filter chips integrate with existing filter area (not separate tabs)
- CONTEXT: Author filter only on Library page (Dashboard shows only user's prompts)
- RESEARCH: Use rounded-full buttons with default/outline variants
- Issue 10 RESOLVED: Author names are display-only text (no click action). Mine/Others filter chips are sufficient for author filtering.

**From prior plans:**
- 15.1-01: Database columns and adapter methods ready
- 15.1-02: Hooks extended with visibility filter support
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add FilterChips component to PromptListView</name>
  <files>src/components/PromptListView.tsx, src/components/FilterChips.tsx (new)</files>
  <action>
1. Create FilterChips component:
```typescript
// src/components/FilterChips.tsx
import { Button } from '@/components/ui/button';
import { Globe, Lock, User, Users } from 'lucide-react';
import { VisibilityFilter, AuthorFilter } from '@/lib/storage/types';

interface FilterChipsProps {
  // Visibility filter
  visibilityFilter: VisibilityFilter;
  onVisibilityChange: (v: VisibilityFilter) => void;

  // Author filter (optional - only shown when provided)
  authorFilter?: AuthorFilter;
  onAuthorChange?: (a: AuthorFilter) => void;
  showAuthorFilter?: boolean;
}

// Chip styling: rounded-full, default for selected, outline for unselected
// Use icons: Globe (public), Lock (private), User (mine), Users (all/others)
```

2. Layout in PromptListView:
```tsx
<div className="flex flex-col gap-4 mb-6">
  {/* Row 1: Search input */}
  <div className="flex items-center gap-4">
    <Input ... />  {/* Existing search */}
  </div>

  {/* Row 2: Filter chips + Sort buttons */}
  <div className="flex items-center justify-between">
    <FilterChips
      visibilityFilter={visibilityFilter}
      onVisibilityChange={onVisibilityChange}
      authorFilter={authorFilter}
      onAuthorChange={onAuthorChange}
      showAuthorFilter={showAuthorFilter}
    />

    <div className="flex gap-2">
      {/* Existing sort buttons */}
    </div>
  </div>
</div>
```

3. Extend PromptListView props:
```typescript
interface PromptListViewProps {
  // ... existing props
  visibilityFilter?: VisibilityFilter;
  onVisibilityChange?: (v: VisibilityFilter) => void;
  authorFilter?: AuthorFilter;
  onAuthorChange?: (a: AuthorFilter) => void;
  showAuthorFilter?: boolean;
}
```

4. Chip design (from RESEARCH):
- Selected: `variant="default" size="sm" className="rounded-full"`
- Unselected: `variant="outline" size="sm" className="rounded-full"`
- Include icon before label: `<Globe className="w-3.5 h-3.5 mr-1" />`
- Group visually: Visibility chips | Author chips (with subtle separator if both shown)

AVOID: Making filter chips too prominent - they should feel integrated, not dominating the search area.
  </action>
  <verify>
TypeScript compiles: `npx tsc --noEmit`
Component renders without errors in isolation.
  </verify>
  <done>
- FilterChips component created with visibility and author filter chips
- PromptListView accepts filter chip props
- Chip styling matches existing button patterns
- Icons display correctly
  </done>
</task>

<task type="auto">
  <name>Task 2: Integrate filters in Dashboard and PublicLibrary pages</name>
  <files>src/components/Dashboard.tsx, src/pages/PublicLibrary.tsx</files>
  <action>
1. Dashboard integration:
```typescript
// Get adapter for persistence
const { adapter } = useStorageAdapter();

// Enable persistence in URL filter hook
const urlFilters = useURLFilterSync({
  debounceMs: 300,
  persistToDb: true,
  adapter: adapter?.stats
});

// Pass to usePromptFilters (already controlled)
const { filteredPrompts, visibilityFilter, ... } = usePromptFilters({
  prompts,
  pinFirst: true,
  controlledState: urlFilters
});

// Pass to PromptListView - NO author filter on Dashboard
<PromptListView
  ...
  visibilityFilter={visibilityFilter}
  onVisibilityChange={urlFilters.setVisibilityFilter}
  showAuthorFilter={false}  // Dashboard shows only user's prompts
/>
```

2. PublicLibrary integration:
```typescript
// Get adapter for persistence
const { adapter } = useStorageAdapter();

// Enable persistence
const urlFilters = useURLFilterSync({
  debounceMs: 300,
  persistToDb: true,
  adapter: adapter?.stats
});

// Pass to usePromptFilters
const { filteredPrompts, visibilityFilter, authorFilter, ... } = usePromptFilters({
  prompts,
  pinFirst: false,
  controlledState: urlFilters
});

// Pass to PromptListView - SHOW author filter on Library
<PromptListView
  ...
  visibilityFilter={visibilityFilter}
  onVisibilityChange={urlFilters.setVisibilityFilter}
  authorFilter={authorFilter}
  onAuthorChange={urlFilters.setAuthorFilter}
  showAuthorFilter={true}  // Library shows all public prompts
/>
```

3. Handle author filter logic in Library:
- "All" = show all public prompts
- "Mine" = filter to prompts where author.id === currentUser.id
- "Others" = filter to prompts where author.id !== currentUser.id

3b. Remove author click functionality (Issue 10 RESOLVED):
- Remove the onAuthorClick prop/handler from PublicLibrary
- Make author names display-only text (no button, no link)
- Mine/Others filter chips provide sufficient author filtering

4. Update usePromptFilters to handle author filtering:
```typescript
// In filter logic (if not already done in 15.1-02)
if (authorFilter && authorFilter !== 'all' && userId) {
  if (authorFilter === 'mine') {
    result = result.filter(p => p.author?.id === userId);
  } else if (authorFilter === 'others') {
    result = result.filter(p => p.author?.id !== userId);
  }
}
```

AVOID: Showing author filter on Dashboard where it's meaningless (all prompts are user's own).
  </action>
  <verify>
`npm run build` succeeds
Manual test: Dashboard and Library pages render with filter chips.
  </verify>
  <done>
- Dashboard has visibility filter chips (no author filter)
- Library has both visibility and author filter chips
- Filters persist to database on change
- Filters load from database on page mount
- URL params still work for sharing filtered views
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete filter system with chips, persistence, and page integration:
- Visibility filter (All/Public/Private) on Dashboard and Library
- Author filter (All/Mine/Others) on Library only
- Filter preferences persist to database
- URL params sync for shareable views
  </what-built>
  <how-to-verify>
1. Run: `npm run dev`
2. Visit: http://localhost:2902/dashboard

**Dashboard tests:**
3. Verify filter chips appear below search bar
4. Click "Public" chip - verify only public prompts shown
5. Click "Private" chip - verify only private prompts shown
6. Click "All" chip - verify all prompts shown
7. Refresh page - verify filter persists (loaded from DB)
8. Check URL shows ?visibility=public when filtering

**Library tests:**
9. Navigate to Library page
10. Verify both visibility AND author filter chips appear
11. Click "Mine" in author filter - verify only your prompts shown
12. Click "Others" - verify only other users' prompts shown
13. Combine filters: "Public" + "Mine" - verify works together
14. Refresh page - verify both filters persist
15. Verify author names on cards are display-only text (no click action)

**Cross-page test:**
16. Set filter on Dashboard, navigate to Library, verify same filter applied
17. Sign out and back in - verify filters persist across sessions
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `npm run build` succeeds
- [ ] `npm run lint` passes
- [ ] Filter chips render correctly on both pages
- [ ] Filtering works as expected
- [ ] Persistence to database works
- [ ] URL params sync correctly
</verification>

<success_criteria>
- Filter chips UI integrated in PromptListView
- Dashboard shows visibility filter only
- Library shows visibility + author filters
- Filters persist to database
- URL params enable shareable filtered views
- Human verification approved
- Phase 15.1 complete
</success_criteria>

<output>
After completion, create `.planning/phases/15.1-visibility-filter-persistence/15.1-03-SUMMARY.md`
</output>

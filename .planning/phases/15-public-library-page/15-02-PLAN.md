---
phase: 15-public-library-page
plan: 02
type: execute
---

<objective>
Create the Public Library page with author filtering and add navigation.

Purpose: Users can browse all public prompts, filter by author, and discover prompts to save or fork.
Output: `/library` route with functional Public Library page, navigation links from Dashboard.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior phase summaries:
@.planning/phases/12-shared-component-architecture/12-03-SUMMARY.md
@.planning/phases/13-url-based-search-filter/13-01-SUMMARY.md
@.planning/phases/15-public-library-page/15-01-SUMMARY.md

# Key source files:
@src/App.tsx
@src/components/Dashboard.tsx
@src/components/PromptListView.tsx
@src/components/PromptCard.tsx
@src/hooks/usePromptFilters.ts
@src/hooks/useURLFilterSync.ts
@src/hooks/usePublicPrompts.ts

**Tech stack available:**
- PromptListView component with renderPromptCard, empty states
- PromptCard with source='public' variant, author prop
- usePromptFilters hook with controlled state support
- useURLFilterSync for URL-persisted filters
- usePublicPrompts hook (from 15-01)

**Established patterns:**
- URL state sync via useURLFilterSync
- Controlled filter state from usePromptFilters
- Protected routes wrapped in RequireAuth
- Dashboard layout pattern (header, stats, list)

**Constraining decisions:**
- Phase 12: PromptCard accepts source='public' and author prop
- Phase 13: URL filter sync with debounced search
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create PublicLibrary page component</name>
  <files>src/pages/PublicLibrary.tsx</files>
  <action>
Create new page component following Dashboard.tsx pattern but for public prompts:

```typescript
import { useState, useMemo } from 'react';
import { useSearchParams } from 'react-router-dom';
import { Library, X } from 'lucide-react';
import { usePublicPrompts } from '@/hooks/usePublicPrompts';
import { usePromptFilters } from '@/hooks/usePromptFilters';
import { useURLFilterSync } from '@/hooks/useURLFilterSync';
import { PromptCard } from '@/components/PromptCard';
import { PromptListView } from '@/components/PromptListView';
import { Button } from '@/components/ui/button';
import type { PublicPrompt } from '@/types/prompt';

export default function PublicLibrary() {
  const { prompts, loading, error } = usePublicPrompts();
  const [searchParams, setSearchParams] = useSearchParams();

  // Author filter from URL
  const authorFilter = searchParams.get('author') || '';

  // URL-synced search/sort state
  const urlFilters = useURLFilterSync({ debounceMs: 300 });

  // Pre-filter by author before passing to usePromptFilters
  const authorFilteredPrompts = useMemo(() => {
    if (!authorFilter) return prompts;
    return prompts.filter(p => p.authorId === authorFilter);
  }, [prompts, authorFilter]);

  const {
    searchTerm,
    sortBy,
    sortDirection,
    setSearchTerm,
    setSortBy,
    toggleSortDirection,
    filteredPrompts,
  } = usePromptFilters({
    prompts: authorFilteredPrompts,
    pinFirst: false, // No pinning in public library
    controlledState: urlFilters,
  });

  // Clear author filter handler
  const clearAuthorFilter = () => {
    const newParams = new URLSearchParams(searchParams);
    newParams.delete('author');
    setSearchParams(newParams, { replace: true });
  };

  // Set author filter handler (for clickable author in cards)
  const setAuthorFilter = (authorId: string) => {
    const newParams = new URLSearchParams(searchParams);
    newParams.set('author', authorId);
    setSearchParams(newParams, { replace: true });
  };

  // Get author display name for filter badge
  const getAuthorDisplayName = () => {
    if (!authorFilter) return '';
    const prompt = prompts.find(p => p.authorId === authorFilter);
    return prompt?.author?.displayName || 'Unknown Author';
  };

  if (error) {
    return (
      <div className="min-h-screen bg-background p-6">
        <div className="max-w-7xl mx-auto text-center py-20">
          <p className="text-destructive">Error loading library: {error.message}</p>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-background p-6">
      <div className="max-w-7xl mx-auto">
        {/* Header */}
        <div className="flex justify-between items-center mb-8">
          <div>
            <div className="flex items-center gap-3">
              <Library className="h-8 w-8 text-primary" />
              <h1 className="text-3xl font-bold text-foreground">Public Library</h1>
            </div>
            <p className="text-muted-foreground mt-1">
              Discover and save prompts shared by the community
            </p>
          </div>
        </div>

        {/* Author filter badge */}
        {authorFilter && (
          <div className="mb-4 flex items-center gap-2">
            <span className="text-sm text-muted-foreground">Filtered by author:</span>
            <Button
              variant="secondary"
              size="sm"
              onClick={clearAuthorFilter}
              className="flex items-center gap-1"
            >
              {getAuthorDisplayName()}
              <X className="h-3 w-3" />
            </Button>
          </div>
        )}

        {/* Prompt list */}
        <PromptListView
          prompts={filteredPrompts}
          loading={loading}
          searchTerm={searchTerm}
          sortBy={sortBy}
          sortDirection={sortDirection}
          onSearchChange={setSearchTerm}
          onSortByChange={setSortBy}
          onSortDirectionChange={toggleSortDirection}
          renderPromptCard={(prompt: PublicPrompt) => (
            <PromptCard
              key={prompt.id}
              prompt={prompt}
              to={`/library/prompt/${prompt.id}`}
              source="public"
              author={prompt.author}
              showPinAction={false}
              showStats={true}
              onAuthorClick={() => setAuthorFilter(prompt.authorId)}
            />
          )}
          emptyIcon={<Library className="h-16 w-16 mx-auto mb-4 text-muted-foreground/50" />}
          emptyTitle="No public prompts yet"
          emptyDescription="Be the first to share a prompt with the community!"
          noResultsTitle="No prompts found"
          noResultsDescription={
            authorFilter
              ? 'This author has no prompts matching your search'
              : 'Try adjusting your search'
          }
        />
      </div>
    </div>
  );
}
```

IMPORTANT: The `onAuthorClick` prop needs to be added to PromptCard. Do this in the same task - add the optional prop to PromptCard:

In `PromptCard.tsx`, add to props interface:
```typescript
/** Callback when author name is clicked (for filtering) */
onAuthorClick?: () => void;
```

And make the author attribution clickable:
```typescript
{author && (
  <button
    type="button"
    onClick={(e) => {
      e.preventDefault();
      e.stopPropagation();
      onAuthorClick?.();
    }}
    className="text-xs text-muted-foreground hover:text-foreground hover:underline"
  >
    by {author.displayName || 'Anonymous'}
  </button>
)}
```

Note: For now, `/library/prompt/${prompt.id}` links to a non-existent route. This is fine - Phase 16+ will add proper prompt detail views. For now, clicking the card just navigates (will 404 or we can handle gracefully).
  </action>
  <verify>
1. TypeScript compiles: `npm run build`
2. Lint passes: `npm run lint`
  </verify>
  <done>
- PublicLibrary.tsx page component created
- Uses usePublicPrompts hook for data
- Author filter via URL param (?author=user-id)
- Author filter badge with clear button
- PromptCard with onAuthorClick prop added
- Clickable author name in PromptCard
  </done>
</task>

<task type="auto">
  <name>Task 2: Add /library route and navigation</name>
  <files>src/App.tsx, src/components/Dashboard.tsx</files>
  <action>
1. In `App.tsx`:
   - Import PublicLibrary: `import PublicLibrary from './pages/PublicLibrary';`
   - Add route BEFORE the catch-all:
   ```typescript
   <Route
     path="/library"
     element={
       <RequireAuth>
         <PublicLibrary />
       </RequireAuth>
     }
   />
   ```
   Place it after /history route and before the catch-all "*" route.

2. In `Dashboard.tsx`, add navigation link to library in the header:
   - Import Link: `import { Link } from 'react-router-dom';`
   - Import Library icon: `import { Plus, Library } from 'lucide-react';`
   - Add link button next to StatsCounter or in header area:
   ```typescript
   <Link to="/library">
     <Button variant="outline" className="flex items-center gap-2">
       <Library className="h-4 w-4" />
       Browse Library
     </Button>
   </Link>
   ```

3. Consider adding a back link in PublicLibrary to Dashboard:
   Already handled by browser back button and header nav - no additional link needed.
  </action>
  <verify>
1. `npm run build` succeeds
2. `npm run lint` passes
3. Navigate to /library in browser - page renders
4. Click "Browse Library" from Dashboard - navigates to /library
  </verify>
  <done>
- /library route registered in App.tsx
- Protected with RequireAuth
- "Browse Library" button in Dashboard header
- Navigation works both directions
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Public Library page with author filtering and navigation</what-built>
  <how-to-verify>
    1. Run: `npm run dev`
    2. Visit: http://localhost:5173/dashboard
    3. Verify: "Browse Library" button visible in header
    4. Click "Browse Library" - navigates to /library
    5. Verify: Library page shows with header, search, sort controls
    6. If you have public prompts: Verify they appear with author attribution
    7. If no public prompts: Verify empty state message
    8. Make a prompt public (if you have one): Toggle visibility in PromptView
    9. Return to library: Verify the prompt now appears
    10. Click author name on a card: Verify URL updates with ?author=...
    11. Verify filter badge appears with author name
    12. Click X on filter badge: Verify filter clears
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] `npm run lint` passes
- [ ] /library route accessible when authenticated
- [ ] Public prompts display with author attribution
- [ ] Author filter via URL param works
- [ ] Navigation between Dashboard and Library works
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- UAT checkpoint approved
- Public Library page functional
- Phase 15 complete, ready for UAT Checkpoint A
</success_criteria>

<output>
After completion, create `.planning/phases/15-public-library-page/15-02-SUMMARY.md`
</output>

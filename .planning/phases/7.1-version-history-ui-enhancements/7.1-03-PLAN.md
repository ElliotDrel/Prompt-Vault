---
phase: 7.1-version-history-ui-enhancements
plan: 03
type: execute
---

<objective>
Complete Phase 7.1 UI enhancements: Current version diff display in "Compare to Previous" mode and revert tracking indicators throughout the UI.

Purpose: Consistent diff behavior for all versions including Current, and visual indicators showing when versions were created via revert.
Output: Current version shows diff from previous, revert tracking displayed in version list and detail view.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/7.1-version-history-ui-enhancements/7.1-01-SUMMARY.md
@.planning/phases/7.1-version-history-ui-enhancements/7.1-02-SUMMARY.md

**Key files:**
@src/components/version-history/VersionHistoryModal.tsx
@src/components/version-history/VersionList.tsx
@src/components/version-history/VersionListItem.tsx
@src/types/prompt.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Show diff for Current version in "Compare to Previous" mode</name>
  <files>src/components/version-history/VersionHistoryModal.tsx</files>
  <action>
When "Current" is selected AND comparisonMode is 'previous':
1. Get the most recent version (versions[0]) as the comparison target
2. Show VersionDiff comparing versions[0] content to current prompt content
3. Show VariableChanges comparing versions[0].variables to prompt.variables
4. Update the "Current Version" detail view section to use VersionDiff when:
   - comparisonMode === 'previous'
   - versions.length > 0 (there is a previous version to compare)
5. Add comparison context label: "Showing differences from Version {N} to current"
6. If no versions exist, show plain text (no diff possible)

This makes the Current card behave consistently with historical version cards - in "Compare to Previous" mode, it shows what changed from the previous state.
  </action>
  <verify>
- Build passes: `npm run build`
- When Current is selected with "Compare to Previous", diff highlighting appears
- When Current is selected with "Compare to Current", no diff (plain text)
  </verify>
  <done>Current version card shows diff from previous version in "Compare to Previous" mode</done>
</task>

<task type="auto">
  <name>Task 2: Display revert tracking in version list and detail view</name>
  <files>src/components/version-history/VersionListItem.tsx, src/components/version-history/VersionHistoryModal.tsx, src/components/version-history/VersionList.tsx</files>
  <action>
1. Update VersionListItem to show revert indicator:
   - Check if version.revertedFromVersionId is set
   - If set, display badge/indicator: "Reverted to V{X}" where X is the version number
   - Use RotateCcw icon from lucide-react with small badge styling
   - Need to look up version number from revertedFromVersionId - pass versions array or version number map as prop

2. Update VersionList to pass revert version lookup:
   - Create a map from version ID to version number
   - Pass to VersionListItem for displaying "Reverted to V{X}"

3. Update VersionHistoryModal detail view for historical versions:
   - If selectedVersion.revertedFromVersionId is set, display:
     "This version was created by reverting to Version {X}"
   - Place this info below the timestamp in the version header
   - Style as muted text with RotateCcw icon

Note: When a revert happens, the OLD state is saved as a new version with revertedFromVersionId pointing to the version that was reverted TO. So the indicator means "at this point, user reverted to version X".
  </action>
  <verify>
- Build passes: `npm run build`
- Lint passes: `npm run lint`
- TypeScript compiles: `npx tsc --noEmit`
  </verify>
  <done>Revert tracking displayed in both version list items and detail view</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Phase 7.1 complete UI enhancements:
- Layout flip (detail left, history right)
- Diff toggle button (show/hide highlighting)
- Current version diff in "Compare to Previous" mode
- Revert tracking indicators
  </what-built>
  <how-to-verify>
1. Run: `npm run dev`
2. Navigate to a prompt with version history
3. Open Version History modal via the History button
4. Verify layout: Detail view on LEFT, version list on RIGHT
5. Test diff toggle:
   - Click "Hide Diff" button - highlighting should disappear
   - Click "Show Diff" button - highlighting should reappear
6. Test Current version diff:
   - Select "Current" in the version list
   - Switch to "Compare to Previous" mode
   - Verify diff highlighting shows changes from most recent version
   - Switch to "Compare to Current" - should show plain text (no diff)
7. Test revert tracking (if you have reverted previously):
   - Find a version created by revert
   - Verify it shows "Reverted to V{X}" indicator in list
   - Select it - verify detail view shows revert info
8. If no revert history exists, create one:
   - Select any historical version and click Revert
   - Confirm the revert
   - Check that the newly created version shows revert indicator
  </how-to-verify>
  <resume-signal>Type "approved" if all UI enhancements work correctly, or describe any issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Current version shows diff in "Compare to Previous" mode
- [ ] Revert indicator appears in version list for reverted versions
- [ ] Revert info displayed in detail view header
- [ ] All previous features still work (layout flip, diff toggle)
- [ ] Human verification passed
- [ ] `npm run build` passes
- [ ] `npm run lint` passes
</verification>

<success_criteria>
- Phase 7.1 complete
- All 5 requirements from ROADMAP implemented:
  1. Current version shows diff from previous in "Compare to Previous" mode
  2. Revert tracking displayed in version history
  3. Diff toggle to show/hide highlighting
  4. Layout flip (history right, prompt left)
  5. Component patterns consistent (deferred - current implementation is acceptable)
- Human verification approved
</success_criteria>

<output>
After completion, create `.planning/phases/7.1-version-history-ui-enhancements/7.1-03-SUMMARY.md`

Update ROADMAP.md to mark Phase 7.1 complete.
Update STATE.md with new decisions and current position.
</output>

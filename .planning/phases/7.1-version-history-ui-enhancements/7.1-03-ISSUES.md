# UAT Issues: Phase 7.1 Plan 03

**Tested:** 2026-01-11 (initial), 2026-01-12 (re-test after fix, additional issues found)
**Source:** .planning/phases/7.1-version-history-ui-enhancements/7.1-03-PLAN.md
**Tester:** User via /gsd:verify-work

## Open Issues

### UAT-011: Versioning captures OLD state instead of NEW state (BLOCKER)

**Discovered:** 2026-01-12
**Phase/Plan:** 7.1-03
**Severity:** Blocker
**Feature:** Version creation logic in storage adapter
**Description:** When editing a prompt, the `updatePrompt` function creates a version snapshot with the OLD content (before the edit) instead of the NEW content (after the edit). This causes version numbers to be "off by one" in terms of content.

**Evidence from database:**
```
Version 1: "v1" at 20:30:42 (correct - initial creation)
Version 2: "v1" at 20:30:53 (WRONG - should be "v2")
Version 3: "v2" at 20:34:40 (WRONG - should be "v3")
```

**Root Cause:** In `supabaseAdapter.ts` lines 198-205, the version is created with:
```typescript
title: oldPromptRow.title,    // OLD content
body: oldPromptRow.body,      // OLD content
```

**Expected:** Version N should contain the content AFTER the Nth save:
- Version 1 = initial creation content
- Version 2 = content after first edit
- Version 3 = content after second edit

**Fix:** Change to use `promptData.title` and `promptData.body` (the NEW content being saved).

---

### UAT-012: Remove separate "Current" entry - merge with latest version

**Discovered:** 2026-01-12
**Phase/Plan:** 7.1-03
**Severity:** Major
**Feature:** Version list UI
**Description:** The UI currently shows "Current" as a separate entry from versions. This is incorrect. The latest version IS Current - they are the same thing. There will never be "unsaved edits" because every change is saved immediately.

**Expected:**
- No separate "Current" entry in version list
- Latest version shows as "Version N (Current)" or "Version N" with a "Current" badge
- Single entry indicates both the version number AND that it's the current state

**Actual:** Shows separate "Current (Live)" entry above the version list.

**Additional Requirements (from re-testing):**

1. **Version 1 as Current:** When there's only 1 version (initial creation), it should show as "Version 1 (Current)" with metadata in the detail view indicating:
   - This is Version 1
   - This is the current version
   - This is the initial version

2. **Revert button on latest version:** The Revert button should be HIDDEN on the latest version because:
   - The latest version IS Current
   - You cannot revert to what you're already at
   - Currently the modal treats "Current" and "latest version" as separate, allowing revert to latest version (which doesn't make sense)

**Files to modify:**
- `src/components/version-history/VersionList.tsx` - Remove Current entry logic, add "Current" badge to latest version
- `src/components/version-history/VersionListItem.tsx` - Add "Current" indicator for latest version
- `src/components/version-history/VersionHistoryModal.tsx` - Remove Current selection handling, hide Revert on latest version

---

### UAT-013: Remove "Unsaved changes" messaging

**Discovered:** 2026-01-12
**Phase/Plan:** 7.1-03
**Severity:** Major
**Feature:** Current entry label
**Description:** The label "Unsaved changes to this prompt" is fundamentally incorrect. There will NEVER be unsaved changes - every edit is saved immediately and creates a new version. This messaging should be completely removed.

**Expected:** No messaging about "unsaved changes" anywhere in the version history UI.
**Actual:** Shows "Unsaved changes to this prompt" under the Current entry.

---

### UAT-014: Remove arePromptsIdentical comparisons

**Discovered:** 2026-01-12
**Phase/Plan:** 7.1-03
**Severity:** Minor
**Feature:** Version comparison logic
**Description:** The `arePromptsIdentical()` function is used to compare "current prompt" with "latest version" to determine if Current should show. This logic is no longer needed because:
1. Current = latest version (always)
2. There are no unsaved changes
3. The separate "Current" entry is being removed (UAT-012)

**Expected:** Remove or repurpose `arePromptsIdentical()` - no longer needed for Current/version comparison.
**Actual:** Used in VersionList and VersionHistoryModal for conditional rendering.

---

### UAT-003: Revert button shown when version matches Current (needs rework in UAT-012)

**Discovered:** 2026-01-11
**Phase/Plan:** 7.1-03-FIX
**Severity:** Minor
**Status:** Partially Resolved - needs rework in UAT-012
**Description:** Revert button now hidden when selected version content matches Current.
**Note:** The content-based comparison will be replaced by version-number-based logic in UAT-012. Hide Revert button on the latest version by version number, not content comparison.

---

### UAT-007: Current tab doesn't show revert info (SUPERSEDED)

**Discovered:** 2026-01-11
**Re-tested:** 2026-01-12 - NOT FIXED
**Phase/Plan:** 7.1-03
**Severity:** Minor → Superseded
**Status:** Will be resolved by UAT-012 refactor
**Description:** If the current prompt state was created by reverting to a previous version, there's no indication of this in the "Current" detail view.
**Note:** Once UAT-012 is implemented (merging Current with latest version), the latest version WILL show revert info if it was created by a revert. This issue becomes moot.

---

### UAT-010: Current entry should always show (SUPERSEDED)

**Discovered:** 2026-01-12
**Phase/Plan:** 7.1-03-FIX
**Severity:** Minor → Superseded
**Status:** Will be resolved by UAT-012 refactor
**Description:** User wanted Current to always be visible. With UAT-012, Current IS the latest version, so it will always be visible as "Version N (Current)".

---

## Resolved Issues

### UAT-001: Version count includes "Current"
**Resolved:** 2026-01-11 - Fixed in 7.1-03-FIX
**Commit:** 8cc7506
**Description:** Version count now only counts saved snapshots, not Current entry.
**Note:** May need adjustment after UAT-012 refactor.

### UAT-002: "Compare to Previous" available for Version 1
**Resolved:** 2026-01-11 - Fixed in 7.1-03-FIX
**Commit:** 8cc7506
**Description:** Compare to Previous button now disabled for Version 1.

### UAT-003: Revert button shown when version matches Current
### UAT-004: False diff when Version 1 matches Current
**Resolved:** 2026-01-11 - Fixed in 7.1-03-FIX
**Commit:** 8cc7506
**Description:** Current entry only shows when there are actual differences.
**Note:** Superseded by UAT-012 - no separate Current entry.

### UAT-005: Current creates illusion of 2 versions
**Resolved:** 2026-01-11 - Fixed in 7.1-03-FIX
**Commit:** 8cc7506
**Description:** Current entry only shows when content differs from latest version.
**Note:** Superseded by UAT-012 - no separate Current entry.

### UAT-006: Historical version detail missing revert info
**Resolved:** 2026-01-11 - Fixed in 7.1-03-FIX
**Commit:** 8cc7506
**Description:** Version detail view now shows "This version was created by reverting to Version X" when applicable.

### UAT-008: Comparison buttons left-aligned
**Resolved:** 2026-01-11 - Fixed in 7.1-03-FIX
**Commit:** 8cc7506
**Description:** Comparison mode buttons now right-aligned in modal header.

### UAT-009: Hide Diff doesn't affect variables
**Resolved:** 2026-01-11 - Fixed in 7.1-03-FIX
**Commit:** 8cc7506
**Description:** Hide Diff toggle now hides variable change badges as well.

### UAT-009b: revertedFromVersionId data flow
**Resolved:** 2026-01-11 - Fixed in 7.1-03-FIX
**Commit:** 8cc7506
**Description:** Revert tracking data now flows correctly to both list and detail view.

---

## Summary

**Open Issues:** 5 (1 Blocker, 2 Major, 2 Minor) + 2 Superseded
**Key Fix Required:** UAT-011 (versioning logic) must be fixed first, then UAT-012/013/014 (UI refactor)

**Correct Versioning Model:**
- Version N = content AFTER the Nth save (not before)
- Version 1 = initial creation (also the current version until edited)
- Latest version = Current (always, no separate "Current" concept)
- There are never "unsaved changes"

**UI Requirements:**
- Latest version shows as "Version N (Current)" with single badge/entry
- Version 1 detail shows "initial version" metadata when it's the only version
- Revert button hidden on latest version (can't revert to what you're already at)
- No separate "Current" entry in version list

---

*Phase: 7.1-version-history-ui-enhancements*
*Plan: 03*
*Initial Test: 2026-01-11*
*Re-test: 2026-01-12*
